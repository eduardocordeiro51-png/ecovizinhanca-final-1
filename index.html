<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EcoVizinhan√ßa 2.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              'verde-esperanca': '#28A745',
              'azul-cerrado': '#1E88E5',
              'amarelo-sol': '#FFC107',
              'cinza-claro': '#F8F9FA',
              'cinza-texto': '#6c757d',
              'cinza-escuro': '#343a40',
            },
            fontFamily: {
              sans: ['Inter', 'sans-serif'],
            },
            boxShadow: {
              'top': '0 -4px 6px -1px rgb(0 0 0 / 0.1), 0 -2px 4px -2px rgb(0 0 0 / 0.1)',
            }
          }
        }
      }
    </script>
    <style>
      .chat-bubble-user {
        background-color: #1E88E5;
        color: white;
        border-radius: 1.25rem 1.25rem 0.25rem 1.25rem;
      }
      .chat-bubble-model {
        background-color: #e5e7eb;
        color: #343a40;
        border-radius: 1.25rem 1.25rem 1.25rem 0.25rem;
      }
      .journey-step-active {
        transform: scale(1.1);
        border-color: #FFC107;
      }
    </style>
</head>
<body class="bg-gray-200">
    <div id="root"></div>
    <script type="module">
        import React, { useState, useEffect, useRef } from "https://esm.run/react@18";
        import ReactDOM from "https://esm.run/react-dom@18/client";
        import { GoogleGenAI } from "https://esm.run/@google/genai";

        // --- TIPOS E CONSTANTES ---
        const Screen = {
          Onboarding: 'ONBOARDING',
          Dashboard: 'DASHBOARD',
          ActionMap: 'ACTION_MAP',
          Challenges: 'CHALLENGES',
          Community: 'COMMUNITY',
          Profile: 'PROFILE',
        };

        const Pillar = {
          EnvironmentalManagement: 'Gest√£o Ambiental',
          EnergyEfficiency: 'Energia e Efici√™ncia',
          UrbanPlanning: 'Planejamento Urbano',
          SustainableEconomy: 'Economia Sustent√°vel',
          SocialGovernance: 'Social e Governan√ßa',
        };

        const UserLevel = {
            Semente: 'Semente',
            Broto: 'Broto',
            Arvore: '√Årvore',
            Floresta: 'Floresta'
        };

        const MOCK_USER = {
          name: 'Ana Silva',
          ecoName: '@AnaDaHorta',
          email: 'ana.silva@email.com',
          cep: '01000-000',
          level: UserLevel.Arvore,
          ecoCoins: 1250,
          xp: 450,
          xpToNextLevel: 1000,
          avatarUrl: 'https://picsum.photos/seed/ecovizinha1/100/100',
          stats: {
            co2SavedKg: 15,
            waterSavedLiters: 300,
            recycledKg: 25,
          },
          badges: ['Mestre da Reciclagem', 'L√≠der Comunit√°rio', 'Amigo das √Årvores'],
        };

        const MOCK_CHALLENGES = [
          { id: 'c1', title: 'Fa√ßa compostagem por uma semana', description: 'Transforme seus res√≠duos org√¢nicos em adubo.', pillar: Pillar.EnvironmentalManagement, ecoCoins: 50, isCompleted: true },
          { id: 'c2', title: 'Descarte 1 litro de √≥leo de cozinha', description: 'Leve seu √≥leo usado a um ponto de coleta.', pillar: Pillar.EnvironmentalManagement, ecoCoins: 30, isCompleted: false },
          { id: 'c3', title: 'Tome um banho de 5 min por 3 dias', description: 'Economize √°gua e energia.', pillar: Pillar.EnergyEfficiency, ecoCoins: 40, isCompleted: false },
        ];

        const MOCK_DONATIONS = [
            { id: 'd1', title: 'Cadeira de escrit√≥rio', author: 'Mariana F.', imageUrl: 'https://picsum.photos/seed/cadeira/200/200', description: 'Em bom estado, com pequeno defeito no bra√ßo.' },
            { id: 'd2', title: 'Livros de fic√ß√£o', author: 'Pedro L.', imageUrl: 'https://picsum.photos/seed/livros/200/200', description: 'Caixa com 10 livros variados.' },
        ];

        const MOCK_MUTIROES = [
            { id: 'm1', title: 'Mutir√£o de Limpeza do C√≥rrego Limpo', date: 'S√°bado, 28/09, 9h', location: 'In√≠cio na Ponte da Av. Principal', participants: 12, description: 'Vamos juntos remover o lixo das margens do nosso c√≥rrego.' },
        ];

        const MOCK_COMMUNITY_POSTS = [
            { id: 'post1', author: 'Carlos Pereira', authorAvatar: 'https://picsum.photos/seed/ecovizinho2/40/40', content: 'Pessoal, algu√©m tem dicas de como come√ßar uma composteira em apartamento?', timestamp: '2h atr√°s' },
        ];

        const PILLAR_COLORS = {
            [Pillar.EnvironmentalManagement]: 'text-green-600',
            [Pillar.EnergyEfficiency]: 'text-blue-600',
        };

        const PILLAR_BG_COLORS = {
            [Pillar.EnvironmentalManagement]: 'bg-green-100',
            [Pillar.EnergyEfficiency]: 'bg-blue-100',
        };

        // --- COMPONENTES DO APLICATIVO ---

        const Onboarding = ({ onLogin }) => {
            const [step, setStep] = useState(0);
            const [name, setName] = useState('');
            const [email, setEmail] = useState('');
            const [cep, setCep] = useState('');
            const [ecoName, setEcoName] = useState('');

            const onboardingSteps = [
                { icon: 'üë•', title: "Conecte-se com sua comunidade.", text: "Fa√ßa parte de uma rede de vizinhos engajados." },
                { icon: 'üåø', title: "Descubra a√ß√µes para um bairro mais verde.", text: "Encontre desafios e participe de mutir√µes." },
                { icon: 'üéÅ', title: "Transforme atitudes em benef√≠cios.", text: "Ganhe EcoMoedas e troque por recompensas." }
            ];

            const handleNext = () => setStep(step + 1);

            const handleSubmit = (event) => {
                event.preventDefault();
                if (name && email && cep && ecoName) {
                    onLogin(name, email, cep, ecoName);
                }
            };
            
            if (step >= onboardingSteps.length) {
                return (
                    <div className="p-8 h-screen flex flex-col justify-center">
                        <h2 className="text-2xl font-bold text-center text-cinza-escuro mb-6">Crie sua conta EcoVizinho</h2>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <input type="text" placeholder="Seu nome completo" value={name} onChange={e => setName(e.target.value)} className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-verde-esperanca" required />
                            <input type="email" placeholder="Seu melhor e-mail" value={email} onChange={e => setEmail(e.target.value)} className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-verde-esperanca" required />
                            <input type="text" placeholder="CEP (para personalizar)" value={cep} onChange={e => setCep(e.target.value)} className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-verde-esperanca" required />
                            <input type="text" placeholder="Seu Nome de EcoVizinho" value={ecoName} onChange={e => setEcoName(e.target.value)} className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-verde-esperanca" required />
                            <button type="submit" className="w-full bg-verde-esperanca text-white font-bold py-3 px-4 rounded-lg hover:bg-green-600 transition-colors">Entrar na Comunidade</button>
                        </form>
                    </div>
                );
            }

            const currentStep = onboardingSteps[step];
            return (
                <div className="bg-white h-screen flex flex-col justify-between">
                    <div className="flex-grow flex flex-col items-center justify-center text-center p-8">
                        <span className="text-6xl text-verde-esperanca mb-6" role="img" aria-label="icon">{currentStep.icon}</span>
                        <h2 className="text-2xl font-bold text-cinza-escuro mb-4">{currentStep.title}</h2>
                        <p className="text-cinza-texto">{currentStep.text}</p>
                    </div>
                    <div className="p-8">
                        <div className="flex justify-center space-x-2 mb-4">
                            {onboardingSteps.map((_, index) => <div key={index} className={`h-2 w-8 rounded-full ${step === index ? 'bg-verde-esperanca' : 'bg-gray-300'}`}></div>)}
                        </div>
                        <button onClick={handleNext} className="w-full bg-verde-esperanca text-white font-bold py-3 px-4 rounded-lg hover:bg-green-600 transition-colors">{step === onboardingSteps.length - 1 ? 'Come√ßar!' : 'Pr√≥ximo'}</button>
                    </div>
                </div>
            );
        };

        const Header = ({ user }) => {
            const progress = (user.xp / user.xpToNextLevel) * 100;
            return (
                <header className="bg-white shadow-md p-4 sticky top-0 z-10">
                    <div className="flex justify-between items-center">
                        <div className="flex items-center space-x-3">
                            <img src={user.avatarUrl} alt="Avatar do usu√°rio" className="w-12 h-12 rounded-full border-2 border-verde-esperanca" />
                            <div>
                                <h1 className="font-bold text-cinza-escuro">{user.name}</h1>
                                <p className="text-sm text-cinza-texto">{user.ecoName}</p>
                            </div>
                        </div>
                        <div className="flex items-center space-x-2 text-amarelo-sol font-bold">
                            <span role="img" aria-label="EcoMoedas" className="text-2xl">ü™ô</span>
                            <span className="text-lg">{user.ecoCoins}</span>
                        </div>
                    </div>
                    <div className="mt-3">
                        <div className="flex justify-between items-center text-sm mb-1">
                            <div className="flex items-center space-x-1 font-semibold text-cinza-escuro">
                                <span role="img" aria-label="N√≠vel" className="text-lg">üå≥</span>
                                <span>N√≠vel: {user.level}</span>
                            </div>
                            <span className="text-cinza-texto">{user.xp} / {user.xpToNextLevel} XP</span>
                        </div>
                        <div className="w-full bg-gray-200 rounded-full h-2.5">
                            <div className="bg-azul-cerrado h-2.5 rounded-full" style={{ width: `${progress}%` }}></div>
                        </div>
                    </div>
                </header>
            );
        };

        const Dashboard = ({ user }) => {
            return (
                <div className="p-4 space-y-6">
                    <div className="bg-white p-4 rounded-lg shadow-md">
                        <h2 className="text-lg font-bold text-cinza-escuro mb-2">Meu Impacto Hoje</h2>
                        <p className="text-center text-xl font-bold text-cinza-escuro">Voc√™ evitou {user.stats.co2SavedKg}kg de CO2 hoje!</p>
                        <div className="mt-4 space-y-2 text-sm text-center">
                            <p><strong>{user.stats.waterSavedLiters}L</strong> de √°gua poupada</p>
                            <p><strong>{user.stats.recycledKg}kg</strong> de lixo reciclado</p>
                        </div>
                    </div>
                    <div className="bg-azul-cerrado text-white p-6 rounded-lg shadow-lg flex items-center space-x-4">
                        <span className="text-5xl" role='img' aria-label='Megafone'>üì£</span>
                        <div>
                            <h3 className="font-bold text-lg">Desafio da Semana</h3>
                            <p className="mt-1">Participe de um mutir√£o de limpeza e ganhe 100 EcoMoedas!</p>
                            <button className="mt-3 bg-white text-azul-cerrado font-bold py-1 px-4 rounded-full text-sm hover:bg-gray-100">Ver Detalhes</button>
                        </div>
                    </div>
                </div>
            );
        };

        const ActionMap = () => {
            const [location, setLocation] = useState(null);
            const [status, setStatus] = useState('Buscando sua localiza√ß√£o...');
            const [error, setError] = useState(null);

            useEffect(() => {
                if (!navigator.geolocation) {
                    setError('Geolocaliza√ß√£o n√£o √© suportada pelo seu navegador.');
                    setStatus('Erro');
                    return;
                }

                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        setLocation({
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude,
                        });
                        setStatus('Localiza√ß√£o encontrada!');
                        setError(null);
                    },
                    (err) => {
                        setError('N√£o foi poss√≠vel obter sua localiza√ß√£o. Verifique as permiss√µes.');
                        setStatus('Erro');
                    }
                );
            }, []);

            return (
                <div className="p-6 h-full flex flex-col items-center justify-center text-center bg-gray-50">
                    <h2 className="text-xl font-bold text-cinza-escuro mb-4">Mapa de Geolocaliza√ß√£o</h2>
                    <div className="w-full max-w-sm p-6 bg-white rounded-lg shadow-md">
                        <div className="flex items-center justify-center space-x-3 mb-4">
                            <span className={`text-3xl ${error ? 'animate-bounce' : 'animate-pulse'}`} role="img" aria-label="√≠cone de mapa">
                                {error ? '‚ùå' : location ? '‚úÖ' : 'üõ∞Ô∏è'}
                            </span>
                            <p className="font-semibold text-lg text-cinza-escuro">{status}</p>
                        </div>
                        {error && <p className="text-red-600 bg-red-100 p-3 rounded-md">{error}</p>}
                        {location && (
                            <div className="mt-4 text-left bg-green-50 p-4 rounded-md border border-green-200">
                                <p className="text-lg text-cinza-escuro font-mono">Lat: <span className="font-bold">{location.latitude.toFixed(5)}</span></p>
                                <p className="text-lg text-cinza-escuro font-mono">Lon: <span className="font-bold">{location.longitude.toFixed(5)}</span></p>
                            </div>
                        )}
                    </div>
                    <p className="mt-6 text-xs text-cinza-texto px-4">Esta tela confirma que o acesso √† sua localiza√ß√£o est√° funcionando.</p>
                </div>
            );
        };

        const Challenges = () => {
            return (
                <div className="p-4 space-y-4">
                    <h2 className="text-xl font-bold text-cinza-escuro">Desafios e A√ß√µes</h2>
                    {MOCK_CHALLENGES.map(challenge => (
                        <div key={challenge.id} className={`p-4 rounded-lg shadow-md border-l-4 ${challenge.isCompleted ? 'bg-gray-100 border-gray-300' : 'bg-white border-verde-esperanca'}`}>
                             <div className="flex justify-between items-start">
                                <div>
                                    <h3 className={`font-bold ${challenge.isCompleted ? 'text-gray-500 line-through' : 'text-cinza-escuro'}`}>{challenge.title}</h3>
                                    <p className="text-sm text-cinza-texto mt-1">{challenge.description}</p>
                                </div>
                                <div className="flex flex-col items-end space-y-1 ml-2">
                                    {challenge.isCompleted ? <span className="text-2xl">‚úÖ</span> : <button className="bg-verde-esperanca text-white rounded-full p-2"><span className="text-xl">‚ûï</span></button>}
                                    <span className="text-sm font-bold text-amarelo-sol">+{challenge.ecoCoins}</span>
                                </div>
                            </div>
                        </div>
                    ))}
                </div>
            );
        };

        const Community = () => {
            return (
                <div className="p-4">
                    <h2 className="text-xl font-bold text-cinza-escuro mb-4">Comunidade</h2>
                    <div className="space-y-6">
                        <div>
                          <h3 className="font-bold text-lg text-azul-cerrado mb-3">Troca & Doa√ß√£o</h3>
                          <div className="grid grid-cols-2 gap-4">
                              {MOCK_DONATIONS.map(item => (
                                <div key={item.id} className="bg-white rounded-lg shadow-md overflow-hidden">
                                  <img src={item.imageUrl} alt={item.title} className="w-full h-24 object-cover" />
                                  <div className="p-3">
                                    <h4 className="font-bold text-sm text-cinza-escuro truncate">{item.title}</h4>
                                    <p className="text-xs text-cinza-texto">Doado por {item.author}</p>
                                    <button className="w-full mt-3 bg-verde-esperanca text-white py-1 px-2 rounded text-xs font-bold">Tenho Interesse</button>
                                  </div>
                                </div>
                              ))}
                          </div>
                        </div>
                    </div>
                </div>
            );
        };

        const Profile = ({ user }) => {
            const journeySteps = [
              { level: UserLevel.Semente, icon: 'üå±' },
              { level: UserLevel.Broto, icon: 'üåø' },
              { level: UserLevel.Arvore, icon: 'üå≥' },
              { level: UserLevel.Floresta, icon: 'üèûÔ∏è' },
            ];
            const currentUserIndex = journeySteps.findIndex(step => step.level === user.level);

            return (
                <div className="p-4 space-y-6">
                    <div className="text-center">
                        <img src={user.avatarUrl} alt="Avatar do usu√°rio" className="w-24 h-24 rounded-full border-4 border-verde-esperanca mx-auto" />
                        <h2 className="text-xl font-bold mt-2 text-cinza-escuro">{user.name}</h2>
                        <p className="text-cinza-texto">{user.ecoName}</p>
                    </div>
                    <div className="bg-white p-4 rounded-lg shadow-md">
                        <h3 className="font-bold text-cinza-escuro mb-4 text-center">Jornada do EcoVizinho</h3>
                        <div className="flex justify-between items-center relative">
                            <div className="absolute top-1/2 left-0 w-full h-1 bg-gray-200 -translate-y-1/2 -z-10"></div>
                            <div className="absolute top-1/2 left-0 h-1 bg-verde-esperanca -translate-y-1/2 -z-10" style={{ width: `${(currentUserIndex / (journeySteps.length - 1)) * 100}%`}}></div>
                            {journeySteps.map((step, index) => (
                                <div key={step.level} className={`w-12 h-12 rounded-full flex items-center justify-center text-3xl bg-white border-2 transition-all duration-300 ${index <= currentUserIndex ? 'border-verde-esperanca' : 'border-gray-200'} ${index === currentUserIndex ? 'journey-step-active' : ''}`}>
                                    {step.icon}
                                </div>
                            ))}
                        </div>
                    </div>
                    <div className="bg-white p-4 rounded-lg shadow-md">
                        <h3 className="font-bold text-cinza-escuro mb-3">Minhas Medalhas</h3>
                        <div className="flex space-x-4 overflow-x-auto pb-2">
                            {user.badges.map(badge => (
                                <div key={badge} className="text-center flex-shrink-0 w-24">
                                    <div className="bg-yellow-100 text-yellow-500 text-4xl w-16 h-16 rounded-full flex items-center justify-center mx-auto">üèÜ</div>
                                    <p className="text-xs mt-1 text-cinza-texto">{badge}</p>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        const BottomNav = ({ activeScreen, setActiveScreen }) => {
            const navItems = [
                { icon: 'üè†', label: 'In√≠cio', screen: Screen.Dashboard },
                { icon: 'üó∫Ô∏è', label: 'Mapa', screen: Screen.ActionMap },
                { icon: 'üèÜ', label: 'Desafios', screen: Screen.Challenges },
                { icon: 'üë•', label: 'Comunidade', screen: Screen.Community },
                { icon: 'üë§', label: 'Perfil', screen: Screen.Profile },
            ];
            return (
                <nav className="fixed bottom-0 left-0 right-0 max-w-lg mx-auto h-16 bg-white border-t border-gray-200 flex justify-around items-center shadow-top z-10">
                    {navItems.map(item => (
                        <button
                            key={item.screen}
                            onClick={() => setActiveScreen(item.screen)}
                            className={`flex flex-col items-center justify-center w-full transition-colors ${activeScreen === item.screen ? 'text-verde-esperanca' : 'text-gray-500'} hover:text-verde-esperanca`}
                        >
                            <span className="text-2xl" role="img" aria-label={item.label}>{item.icon}</span>
                            <span className="text-xs mt-1">{item.label}</span>
                        </button>
                    ))}
                </nav>
            );
        };

        const EcoAssistant = ({ onClose }) => {
            const [messages, setMessages] = useState([
                { from: 'model', text: 'Ol√°! Sou seu EcoAssistente. Como posso ajudar voc√™ a ser mais sustent√°vel hoje?' }
            ]);
            const [input, setInput] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const chatEndRef = useRef(null);

            useEffect(() => {
                chatEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            }, [messages]);

            const handleSend = async () => {
                if (!input.trim() || isLoading) return;
                
                const userMessage = { from: 'user', text: input };
                setMessages(prev => [...prev, userMessage]);
                setInput('');
                setIsLoading(true);

                try {
                    if (!process.env.API_KEY) {
                        console.error("API_KEY n√£o encontrada. O EcoAssistente n√£o pode funcionar sem ela.");
                        const errorMessage = { from: 'model', text: 'üòï Desculpe, a minha conex√£o com a intelig√™ncia artificial n√£o foi configurada. O EcoAssistente est√° indispon√≠vel.' };
                        setMessages(prev => [...prev, errorMessage]);
                        setIsLoading(false);
                        return;
                    }

                    const ai = new GoogleGenAI({ apiKey: process.env.API_KEY });
                    const response = await ai.models.generateContent({
                        model: 'gemini-2.5-flash',
                        contents: input,
                        config: {
                            systemInstruction: 'Voc√™ √© o EcoAssistente, um chatbot amig√°vel e especialista em sustentabilidade para o aplicativo EcoVizinhan√ßa. Suas respostas devem ser curtas, diretas, √∫teis e sempre em portugu√™s do Brasil. Use emojis para deixar a conversa mais leve.',
                        }
                    });
                    const modelMessage = { from: 'model', text: response.text };
                    setMessages(prev => [...prev, modelMessage]);
                } catch (error) {
                    console.error("Erro na API Gemini:", error);
                    const errorMessage = { from: 'model', text: 'üòï Desculpe, n√£o consegui processar sua pergunta. Tente novamente mais tarde.' };
                    setMessages(prev => [...prev, errorMessage]);
                } finally {
                    setIsLoading(false);
                }
            };
            
            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-end justify-center z-50">
                    <div className="bg-white w-full max-w-lg h-4/5 rounded-t-2xl flex flex-col shadow-lg">
                        <header className="flex items-center justify-between p-4 border-b">
                            <h2 className="font-bold text-lg text-cinza-escuro">‚ú® EcoAssistente</h2>
                            <button onClick={onClose} className="text-2xl text-gray-500">&times;</button>
                        </header>
                        <main className="flex-1 p-4 overflow-y-auto space-y-4">
                            {messages.map((msg, index) => (
                                <div key={index} className={`flex ${msg.from === 'user' ? 'justify-end' : 'justify-start'}`}>
                                    <div className={`p-3 max-w-xs md:max-w-md ${msg.from === 'user' ? 'chat-bubble-user' : 'chat-bubble-model'}`}>{msg.text}</div>
                                </div>
                            ))}
                            {isLoading && (
                                <div className="flex justify-start">
                                   <div className="p-3 chat-bubble-model">
                                        <div className="flex items-center space-x-2">
                                          <div className="w-2 h-2 bg-gray-500 rounded-full animate-pulse"></div>
                                          <div className="w-2 h-2 bg-gray-500 rounded-full animate-pulse" style={{ animationDelay: '0.2s' }}></div>
                                          <div className="w-2 h-2 bg-gray-500 rounded-full animate-pulse" style={{ animationDelay: '0.4s' }}></div>
                                        </div>
                                   </div>
                                </div>
                            )}
                            <div ref={chatEndRef} />
                        </main>
                        <footer className="p-4 border-t bg-white">
                            <div className="flex items-center space-x-2">
                                <input type="text" value={input} onChange={e => setInput(e.target.value)} onKeyPress={e => e.key === 'Enter' && handleSend()} placeholder="Pergunte algo..." className="flex-1 p-2 border rounded-full focus:ring-2 focus:ring-verde-esperanca" disabled={isLoading} />
                                <button onClick={handleSend} disabled={isLoading || !input.trim()} className="bg-verde-esperanca text-white w-10 h-10 rounded-full flex items-center justify-center disabled:bg-gray-400">
                                   <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" className="w-5 h-5"><path d="M3.105 2.289a.75.75 0 00-.826.95l1.414 4.925A1.5 1.5 0 005.135 9.25h6.115a.75.75 0 010 1.5H5.135a1.5 1.5 0 00-1.442 1.086L2.279 16.76a.75.75 0 00.95.826l16-5.333a.75.75 0 000-1.418l-16-5.333z" /></svg>
                                </button>
                            </div>
                        </footer>
                    </div>
                </div>
            );
        };

        // --- APLICATIVO PRINCIPAL ---

        const App = () => {
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [user, setUser] = useState(null);
            const [activeScreen, setActiveScreen] = useState(Screen.Dashboard);
            const [isAssistantOpen, setIsAssistantOpen] = useState(false);

            const handleLogin = (name, email, cep, ecoName) => {
                setUser({ ...MOCK_USER, name, email, cep, ecoName });
                setIsAuthenticated(true);
            };

            const renderScreen = () => {
                if (!user) return null;
                switch (activeScreen) {
                    case Screen.Dashboard: return <Dashboard user={user} />;
                    case Screen.ActionMap: return <ActionMap />;
                    case Screen.Challenges: return <Challenges />;
                    case Screen.Community: return <Community />;
                    case Screen.Profile: return <Profile user={user} />;
                    default: return <Dashboard user={user} />;
                }
            };

            if (!isAuthenticated || !user) {
                return <Onboarding onLogin={handleLogin} />;
            }

            return (
                <div className="bg-cinza-claro font-sans h-screen w-full flex flex-col max-w-lg mx-auto shadow-2xl relative">
                    <Header user={user} />
                    <main className="flex-grow overflow-y-auto pb-20 bg-gray-50">
                        {renderScreen()}
                    </main>
                    <BottomNav activeScreen={activeScreen} setActiveScreen={setActiveScreen} />
                    <button 
                      onClick={() => setIsAssistantOpen(true)}
                      className="absolute bottom-20 right-4 bg-azul-cerrado text-white w-14 h-14 rounded-full flex items-center justify-center shadow-lg text-3xl hover:bg-blue-600 transition-colors"
                      aria-label="Abrir EcoAssistente"
                    >
                      ‚ú®
                    </button>
                    {isAssistantOpen && <EcoAssistant onClose={() => setIsAssistantOpen(false)} />}
                </div>
            );
        };

        // --- INICIALIZA√á√ÉO DO APLICATIVO ---
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(
          <React.StrictMode>
            <App />
          </React.StrictMode>
        );

    </script>
</body>
</html>
